<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPIs OPS INDRIVE - Veikul</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="bg-slate-950 text-slate-100">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="flex justify-between items-start mb-8">
            <div>
                <div class="flex items-center gap-4 mb-3">
                    <svg width="50" height="50" viewBox="0 0 1200 1200" fill="none">
                        <path d="M598.334 474.408C641.995 474.408 677.389 439.171 677.389 395.704C677.389 352.237 641.995 317 598.334 317C554.672 317 519.278 352.237 519.278 395.704C519.278 439.171 554.672 474.408 598.334 474.408Z" fill="#00D195"/>
                        <path d="M547.709 564.395L872.808 446.668C881.512 443.507 890.854 442.484 900.04 443.683C909.226 444.883 917.985 448.269 925.576 453.557C933.168 458.844 939.367 465.876 943.647 474.057C947.927 482.237 950.162 491.324 950.163 500.547C950.174 512.313 946.558 523.798 939.802 533.45C933.045 543.103 923.474 550.458 912.383 554.521L610.14 663.409L912.383 772.672C923.474 776.736 933.045 784.09 939.802 793.743C946.558 803.396 950.174 814.881 950.163 826.646C950.162 835.87 947.927 844.957 943.647 853.138C939.367 861.318 933.168 868.35 925.576 873.637C917.985 878.925 909.226 882.312 900.04 883.511C890.854 884.71 881.512 883.686 872.808 880.526L547.709 762.894C527.239 755.471 509.556 741.965 497.054 724.204C484.552 706.442 477.836 685.285 477.815 663.597C477.828 641.918 484.543 620.77 497.046 603.021C509.551 585.274 527.239 571.788 547.709 564.395Z" fill="#00D195"/>
                        <path d="M722.349 663.597C722.327 685.285 715.611 706.442 703.11 724.204C690.608 741.965 672.925 755.471 652.454 762.894L327.355 880.526C318.651 883.686 309.31 884.71 300.124 883.511C290.938 882.312 282.178 878.925 274.587 873.637C266.995 868.35 260.797 861.318 256.517 853.138C252.237 844.957 250.001 835.87 250 826.646C249.989 814.881 253.606 803.396 260.362 793.743C267.119 784.09 276.69 776.736 287.78 772.672L589.551 663.409L287.875 554.521C276.784 550.458 267.214 543.103 260.457 533.45C253.7 523.798 250.083 512.313 250.095 500.547C250.096 491.324 252.331 482.237 256.611 474.057C260.891 465.876 267.09 458.844 274.681 453.557C282.272 448.269 291.032 444.883 300.219 443.683C309.405 442.484 318.746 443.507 327.45 446.668L652.55 564.395C673.002 571.804 690.669 585.297 703.155 603.043C715.642 620.789 722.342 641.93 722.349 663.597Z" fill="#B3F0E0"/>
                        <path d="M610.423 663.411L912.665 772.675C923.756 776.738 933.326 784.093 940.083 793.745C946.84 803.397 950.457 814.883 950.446 826.648C950.444 835.872 948.209 844.959 943.929 853.139C939.649 861.32 933.45 868.352 925.859 873.639C918.268 878.927 909.507 882.313 900.321 883.512C891.135 884.712 881.794 883.688 873.09 880.528L547.99 762.895C527.521 755.473 509.838 741.966 497.336 724.206C484.834 706.445 478.117 685.287 478.097 663.599C478.172 650.731 480.605 637.985 485.275 625.986L610.423 663.411Z" fill="#00D195"/>
                    </svg>
                    <div>
                        <h1 class="text-4xl font-bold" style="color: #00cc99">KPIs OPS INDRIVE</h1>
                        <p class="text-sm" style="color: #00b88a">Powered by Veikul</p>
                    </div>
                </div>
            </div>
            <select id="citySelector" class="bg-slate-800 border border-slate-700 text-slate-200 px-4 py-2 rounded-lg">
                <option value="">üìç Seleccionar ciudad...</option>
                <option value="TODAS">üåé TODAS</option>
                <option value="CDMX">CDMX</option>
                <option value="GDL">GDL</option>
                <option value="M√©rida">M√©rida</option>
            </select>
        </div>

        <!-- Mensaje inicial -->
        <div id="emptyState" class="flex items-center justify-center h-96">
            <div class="text-center">
                <h3 class="text-2xl font-semibold mb-2" style="color: #00cc99">Selecciona una ciudad</h3>
                <p class="text-slate-400">Elige una ciudad del men√∫ superior</p>
            </div>
        </div>

        <!-- Gr√°ficas -->
        <div id="chartsContainer" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-slate-900 rounded-xl p-6">
                <h3 class="text-lg font-bold mb-4" style="color: #00cc99">Autos con >$1</h3>
                <canvas id="chart1"></canvas>
            </div>
            <div class="bg-slate-900 rounded-xl p-6">
                <h3 class="text-lg font-bold mb-4" style="color: #fb923c">% Autos en Siniestro</h3>
                <canvas id="chart2"></canvas>
            </div>
            <div class="bg-slate-900 rounded-xl p-6">
                <h3 class="text-lg font-bold mb-4" style="color: #326cf2">% Duplas</h3>
                <canvas id="chart3"></canvas>
            </div>
            <div class="bg-slate-900 rounded-xl p-6">
                <h3 class="text-lg font-bold mb-4" style="color: #10b981">% Autos con $7,500+</h3>
                <canvas id="chart4"></canvas>
            </div>
        </div>
    </div>

    <script>
        const DATA = {
            semanal: [
                {semana:'40',ciudad:'CDMX',autos1:35,siniestro:5.26,duplas:0,fact7500:27.78},
                {semana:'41',ciudad:'CDMX',autos1:33,siniestro:13.16,duplas:0,fact7500:18.18},
                {semana:'42',ciudad:'CDMX',autos1:35,siniestro:7.89,duplas:0,fact7500:31.43},
                {semana:'43',ciudad:'CDMX',autos1:34,siniestro:7.89,duplas:0,fact7500:8.57},
                {semana:'40',ciudad:'GDL',autos1:21,siniestro:20.69,duplas:0,fact7500:43.48},
                {semana:'41',ciudad:'GDL',autos1:25,siniestro:13.79,duplas:0,fact7500:44.00},
                {semana:'42',ciudad:'GDL',autos1:25,siniestro:10.34,duplas:0,fact7500:42.31},
                {semana:'43',ciudad:'GDL',autos1:23,siniestro:10.34,duplas:0,fact7500:53.85},
                {semana:'40',ciudad:'M√©rida',autos1:39,siniestro:16.67,duplas:2.50,fact7500:75.00},
                {semana:'41',ciudad:'M√©rida',autos1:41,siniestro:14.58,duplas:9.75,fact7500:65.85},
                {semana:'42',ciudad:'M√©rida',autos1:41,siniestro:12.50,duplas:2.38,fact7500:64.29},
                {semana:'43',ciudad:'M√©rida',autos1:45,siniestro:6.25,duplas:4.44,fact7500:73.33}
            ]
        };

        let charts = {};

        document.getElementById('citySelector').addEventListener('change', (e) => {
            const city = e.target.value;
            if (!city) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('chartsContainer').classList.add('hidden');
                return;
            }

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('chartsContainer').classList.remove('hidden');

            const filteredData = city === 'TODAS' 
                ? DATA.semanal 
                : DATA.semanal.filter(d => d.ciudad === city);

            updateCharts(filteredData, city);
        });

        function updateCharts(data, city) {
            Object.values(charts).forEach(chart => chart.destroy());

            if (city === 'TODAS') {
                createMultiCityCharts(data);
            } else {
                createSingleCityCharts(data);
            }
        }

        function createSingleCityCharts(data) {
            const labels = data.map(d => `S${d.semana}`);

            charts.chart1 = new Chart(document.getElementById('chart1'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Autos',
                        data: data.map(d => d.autos1),
                        borderColor: '#00cc99',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });

            charts.chart2 = new Chart(document.getElementById('chart2'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: '%',
                        data: data.map(d => d.siniestro),
                        borderColor: '#fb923c',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });

            charts.chart3 = new Chart(document.getElementById('chart3'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: '%',
                        data: data.map(d => d.duplas),
                        borderColor: '#326cf2',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });

            charts.chart4 = new Chart(document.getElementById('chart4'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: '%',
                        data: data.map(d => d.fact7500),
                        borderColor: '#10b981',
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
        }

        function createMultiCityCharts(data) {
            const semanas = [...new Set(data.map(d => d.semana))];
            const cities = ['CDMX', 'GDL', 'M√©rida'];
            const colors = {'CDMX': '#00cc99', 'GDL': '#326cf2', 'M√©rida': '#f59e0b'};

            const datasets1 = cities.map(c => ({
                label: c,
                data: semanas.map(s => {
                    const row = data.find(d => d.semana === s && d.ciudad === c);
                    return row ? row.autos1 : null;
                }),
                borderColor: colors[c],
                tension: 0.4
            }));

            charts.chart1 = new Chart(document.getElementById('chart1'), {
                type: 'line',
                data: { labels: semanas.map(s => `S${s}`), datasets: datasets1 },
                options: { responsive: true, maintainAspectRatio: true }
            });

            const datasets2 = cities.map(c => ({
                label: c,
                data: semanas.map(s => {
                    const row = data.find(d => d.semana === s && d.ciudad === c);
                    return row ? row.siniestro : null;
                }),
                borderColor: colors[c],
                tension: 0.4
            }));

            charts.chart2 = new Chart(document.getElementById('chart2'), {
                type: 'line',
                data: { labels: semanas.map(s => `S${s}`), datasets: datasets2 },
                options: { responsive: true, maintainAspectRatio: true }
            });

            const datasets3 = cities.map(c => ({
                label: c,
                data: semanas.map(s => {
                    const row = data.find(d => d.semana === s && d.ciudad === c);
                    return row ? row.duplas : null;
                }),
                borderColor: colors[c],
                tension: 0.4
            }));

            charts.chart3 = new Chart(document.getElementById('chart3'), {
                type: 'line',
                data: { labels: semanas.map(s => `S${s}`), datasets: datasets3 },
                options: { responsive: true, maintainAspectRatio: true }
            });

            const datasets4 = cities.map(c => ({
                label: c,
                data: semanas.map(s => {
                    const row = data.find(d => d.semana === s && d.ciudad === c);
                    return row ? row.fact7500 : null;
                }),
                borderColor: colors[c],
                tension: 0.4
            }));

            charts.chart4 = new Chart(document.getElementById('chart4'), {
                type: 'line',
                data: { labels: semanas.map(s => `S${s}`), datasets: datasets4 },
                options: { responsive: true, maintainAspectRatio: true }
            });
        }
    </script>
</body>
</html>
